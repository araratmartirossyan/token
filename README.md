# token-manager 
Библиотека для обновления токенов авторизации
 
# Установка 
**1. Склонировать репозиторий в папку рядом с разрабатываемым проектом** 
 
`$ git clone https://gitlab.ops.xn--90aflpmbkdt4g.xn--p1ai/mdt/packages/token-manager.git` 
 
**2. Слинковать библиотеку с проектом**
 
Выполнить команду из директории разрабатываемого проекта:

`$ npm link '../token-manager` 
    
# Использование

**1.  Инициализация**

Token Manager при инициализации принимает 2 параметра: 

 1) функцию, возвращающую запрос на обновление токена в виде Promise

 2) access и refresh токены, если они были получены ранее в виде

```js
import { TokenManager } from 'token-manager';

const tokenRefresher = () => new Promise<TokenPair>((resolve, reject) => {
    // запрос на обновление токенов ...
    resolve({ accessToken: '...', refreshToken: '...'});
});

const initialTokenPair = { accessToken: '...', refreshToken: '...' };
const tokenManager = new TokenManager(tokenRefresher, initialTokenPair);
```

**2.  Ручное обновление токенов**

Если токены были обновлены (н-р, при логине другого пользователя), то их новые значения необходимо передать Token Manager'у:

```js
tokenManager.updateTokens({ accessToken, refreshToken });
```

**3.  Получение токенов**

Для того чтобы получить актуальные токены необходимо вызвать метод: 

```js
tokenManager.getTokens();
```

Данный метод возвращает токены в виде Observable (RxJS). 
Если менеджер содержит в себе актуальные значения токенов, он возвратит их сразу же, если нет, то они будут возвращены при окончании запроса на обновление токенов

**4. Обновление токенов**

При ошибке запроса, связанной с устаревшими токенами, необходимо вызвать метод их обновления. Метод возвращает обновленные токены в виде Observable: 

```js
tokenManager.refreshTokens();
```

# FAQ

    Q: При линковке библиотеки возникает ошибка
    A: Удалите node_modules из папки библиотеки (token_manager) и повторите линковку

    Q: При установке других зависимостей выдается ошибка, что библиотека не подключена
    A: Повторите линковку библиотеки